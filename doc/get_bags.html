<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>get_bags</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">get_bags</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In this vignette we will explore the function
<code>get_bags()</code>. This function is used internally in both
<code>aurora_pheno()</code> and <code>aurora_GWAS()</code> but can be
also accessed directly upon installing <em>aurora</em>. The function
takes a dataset of microbial strains and returns a bootstrapped dataset
that is adjusted for population structure. <code>get_bags()</code> has
many possible uses and we will demonstrate a few here.</p>
</div>
<div id="description-of-function-get_bags" class="section level2">
<h2>Description of function <code>get_bags()</code></h2>
<p>This function requires two inputs. The phenotype matrix
(<code>pheno_mat</code>) which has to be in the same format as the one
used in <code>aurora_pheno()</code> and <code>aurora_GWAS()</code> and a
phylogenetic reconstruction. This can be either a phylogenetic tree
loaded as a phylo object or a distance matrix that contains phylogenetic
pairwise distances (core genome amino acid identities (cAAI) or average
nucleotide identities (ANI) converted to distances).</p>
</div>
<div id="objective" class="section level2">
<h2>Objective</h2>
<p>Example 1: <code>aurora_pheno()</code> uses a grid search to
fine-tune hyperparameters for Random Forest and AdaBoost. However, this
process is very time consuming. Additionally, the user is only
restricted to the parameters that are in the grid that
<code>aurora_pheno()</code> uses (see supplementary materials in the
<em>aurora</em> paper). However, you can use <code>get_bags()</code> to
get adjusted datasets and then use your favorite hyperparameter search
method to get the best results.</p>
<p>Example 2: <code>aurora_pheno()</code> uses four machine learning
algorithms to identify the mislabeled strains. However, these machine
learning algorithms may not be optimal for your dataset and you may want
to explore other options. Machine learning algorithms often learn the
phylogenetic background rather than the existing causal features. To
minimize this issue we will first use <code>get_bags()</code> to obtain
multiple bootstrapped datasets that are adjusted for phylogenetic
non-independence and then construct corresponding XGBoost models. The
results from these models will be combined to obtain the most probable
causal features and to identify potentially mislabeled strains (a simple
implementation of <code>aurora_pheno()</code> and
<code>aurora_GWAS()</code>).</p>
<p>Example 3: In scientific literature I often encounter plots that are
showing cluster analysis of microbial strains. The results of the
analysis are then displayed in two dimensions. Such plots are supposed
to convince us that <em>i.e.,</em> cluster A is more associated with
trait B. Moreover, some dimensionality reduction techniques, like PCA,
aims to capture the maximum variability in the dataset. However,
population structure and sampling bias can distort such plot. We will
use function <code>get_bags()</code> to reduce the influence of
population structure and sampling bias. First we will obtain a
population adjusted dataset and then we will calculate Jaccard distance
between all strains. The resulting distance matrix will be plotted to
two dimensions.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(aurora)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(mlr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(proxy)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span></code></pre></div>
<p>Now let’s load some data. We will use <em>Limosilactobacillus
reuteri</em> datset. This dataset contains 207 strains from five
different hosts. As a feature table we will use pangenome matrix
produced by <a href="https://github.com/gtonkinhill/panaroo">Panaroo</a>. We will first
need to convert this pangenome into a binary format. Additionally, we
will filter out the most common (present in more than 95% of all
strains) and the rarest (present in less than 10% of all strains)
genes.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;pheno_mat_reuteri&quot;</span>) <span class="co"># loads the phenotype for each strain</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;bin_mat_reuteri&quot;</span>) <span class="co"># loads the pangenome matrix</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;tree_reuteri&quot;</span>) <span class="co"># loads the core-genome phylogenetic tree</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co"># convert the pangenome matrix to binary matrix</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>bin_mat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bin_mat)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>fut_row_names <span class="ot">&lt;-</span> bin_mat<span class="sc">$</span>Gene</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>bin_mat <span class="ot">&lt;-</span> bin_mat[, <span class="sc">-</span><span class="dv">1</span><span class="sc">:-</span><span class="dv">14</span>]</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>bin_mat <span class="ot">&lt;-</span> bin_mat <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">replace</span>(., .<span class="sc">!=</span><span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>bin_mat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(bin_mat, as.numeric)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>bin_mat <span class="ot">&lt;-</span> <span class="fu">t</span>(bin_mat)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="fu">colnames</span>(bin_mat) <span class="ot">&lt;-</span> fut_row_names</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>bin_mat <span class="ot">&lt;-</span> bin_mat[<span class="fu">match</span>(pheno_mat<span class="sc">$</span>ids, <span class="fu">rownames</span>(bin_mat)), ]</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>no_gf <span class="ot">&lt;-</span> <span class="fu">nrow</span>(bin_mat)</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> no_gf <span class="sc">*</span> (<span class="dv">95</span><span class="sc">/</span><span class="dv">100</span>) <span class="co"># remove abundat features</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>select_ID_up <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colSums</span>(bin_mat) <span class="sc">&lt;</span> cutoff)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> no_gf <span class="sc">*</span> (<span class="dv">5</span><span class="sc">/</span><span class="dv">100</span>) <span class="co"># remove rare features</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>non_select_ID_low <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colSums</span>(bin_mat) <span class="sc">&gt;</span> cutoff)</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>bin_mat <span class="ot">&lt;-</span> bin_mat[, <span class="fu">intersect</span>(select_ID_up, non_select_ID_low)]</span></code></pre></div>
</div>
<div id="example-1" class="section level1">
<h1>Example 1</h1>
<p>With the data loaded we can run <code>get_bags()</code> to obtain the
bootstrapped dataset. <em>aurora</em> uses two algorithms to bootstrap
the data: <code>phylogenetic_walk</code> and <code>random_walk</code>.
This is controlled by a parameter <code>bagging</code>. If you wish to
find out the distinctions between the two algorithms, please refer to
the supplementary materials of the <em>aurora</em> paper. Both
algorithms are stochastic and therefore you should either repeat the
hyperparameter tuning multiple times (each time with different
bootstrapped dataset) or you can simply set the parameter
<code>bag_size</code> to a large number. This parameter controls how
many strains from each class will be selected to the bootstrapped
dataset. If you want to repeat the parameter search multiple times, you
can get multiple bags with just one run of <code>get_bags()</code> by
changing the parameter <code>no_rf</code>. In this case, we will set
<code>bag_size</code> to a large number and then use random
hyperparameter search to find the best hyperparameters for random forest
model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Get the train dataset</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>bag <span class="ot">&lt;-</span> <span class="fu">get_bags</span>(pheno_mat,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                <span class="at">dist_mat_or_tree =</span> tree, </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                <span class="at">bag_size =</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>) <span class="co"># number of strains in each class</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>                )</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># The number of strains in each class should be balanced for Random Forest</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Get bags also outputs $count which shows the number of strain repetitions</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co"># Construct new pheno_mat and bin_mat</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>boot_pheno_mat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ids =</span> bag<span class="sc">$</span>bags[[<span class="dv">1</span>]],</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>                             <span class="at">pheno =</span> pheno_mat<span class="sc">$</span>pheno[<span class="fu">match</span>(bag<span class="sc">$</span>bags[[<span class="dv">1</span>]], pheno_mat<span class="sc">$</span>ids)])</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>boot_bin_mat<span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bin_mat[<span class="fu">match</span>(bag<span class="sc">$</span>bags[[<span class="dv">1</span>]], <span class="fu">rownames</span>(bin_mat)), ])</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>boot_bin_mat<span class="sc">$</span>host <span class="ot">&lt;-</span> boot_pheno_mat<span class="sc">$</span>pheno</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co"># gene names from panaroo are not valid column names</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>gene_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(boot_bin_mat)[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(boot_bin_mat)<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="fu">colnames</span>(boot_bin_mat)[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(boot_bin_mat)<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">&quot;gene&quot;</span>, <span class="fu">ncol</span>(boot_bin_mat)<span class="sc">-</span><span class="dv">1</span>), <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(boot_bin_mat)<span class="sc">-</span><span class="dv">1</span>))</span></code></pre></div>
<p>Now we are ready to run the hyperparameter tuning. Any method can be
used (random search, manual search, gird search, Bayesian optimization,
etc.). In this case, random search will be used. This method is
implemented in package <code>mlr</code>. We need to choose a measurement
of the models’ performance. In real scenario, you might want to use <a href="https://towardsdatascience.com/understanding-auc-roc-curve-68b2303cc9c5">AUC</a>
or an <a href="https://towardsdatascience.com/the-f1-score-bec2bbc38aa6">F1
Score</a> however let’s keep things simple here and use accuracy. Keep
in mind that the grid search that <code>aurora_pheno()</code> uses takes
a long time to complete (especially if the your dataset has over 500
strains, over 10,000 features and more than two classes). In such a case
you are forced to find your own hyperparameters.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>task <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> boot_bin_mat, <span class="at">target =</span> <span class="st">&quot;host&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># define hyperparameter search space</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>param_set <span class="ot">&lt;-</span> <span class="fu">makeParamSet</span>(</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">makeIntegerParam</span>(<span class="st">&quot;sampsize&quot;</span>, <span class="at">lower =</span> <span class="dv">50</span>, <span class="at">upper =</span> <span class="dv">200</span>),</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">makeIntegerParam</span>(<span class="st">&quot;ntree&quot;</span>, <span class="at">lower =</span> <span class="dv">50</span>, <span class="at">upper =</span> <span class="dv">500</span>),</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">makeIntegerParam</span>(<span class="st">&quot;mtry&quot;</span>, <span class="at">lower =</span> <span class="dv">10</span>, <span class="at">upper =</span> <span class="dv">1000</span>), </span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="fu">makeIntegerParam</span>(<span class="st">&quot;maxnodes&quot;</span>, <span class="at">lower =</span> <span class="dv">4</span>, <span class="at">upper =</span> <span class="dv">20</span>)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  )</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">makeTuneControlRandom</span>(<span class="at">maxit =</span> <span class="dv">10</span>) <span class="co"># set search method as random</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">tuneParams</span>(</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="fu">makeLearner</span>(<span class="st">&quot;classif.randomForest&quot;</span>),</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  task,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">makeResampleDesc</span>(<span class="st">&quot;CV&quot;</span>, <span class="at">iters =</span> <span class="dv">4</span>),  <span class="co"># 4-fold cross-validation</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  <span class="at">measures =</span> <span class="fu">list</span>(acc),  <span class="co"># Use accuracy as the performance measure</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  <span class="at">par.set =</span> param_set,</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>  <span class="at">control =</span> ctrl</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>)</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>best_params <span class="ot">&lt;-</span> result<span class="sc">$</span>x</span></code></pre></div>
<p>The best hyperparameters are now in list <code>best_params</code>and
we can use it to run <code>aurora_pheno()</code> (run only with random
forest).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;pheno_mat_reuteri&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;bin_mat_reuteri&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;tree_reuteri&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>results_aurora <span class="ot">&lt;-</span> <span class="fu">aurora_pheno</span>(<span class="at">pheno_mat =</span> pheno_mat,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>                               <span class="at">bin_mat =</span> bin_mat,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>                               <span class="at">type_bin_mat =</span> <span class="st">&quot;panaroo&quot;</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>                               <span class="at">tree =</span> tree,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>                               <span class="at">fit_parameters =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>                               <span class="at">sampsize =</span> best_params<span class="sc">$</span>sampsize,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>                               <span class="at">mtry =</span> best_params<span class="sc">$</span>mtry,</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>                               <span class="at">ntree =</span> best_params<span class="sc">$</span>ntree,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>                               <span class="at">maxnodes =</span> best_params<span class="sc">$</span>maxnodes,</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>                               <span class="at">ovr_log_reg =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>                               <span class="at">adaboost =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>                               <span class="at">CART =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>                               <span class="at">write_data =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="example-2" class="section level1">
<h1>Example 2:</h1>
<p>In this example we will use the function <code>get_bags()</code> to
get 10 bootstrapped datasets. This datasets will be used as training
datasets to construct 10 corresponding XGBoost models. We don’t want the
training dataset to be too large. This could lead to extensive strain
repetition which could result in XGBoost models that learned the
features present in those repeating strains.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Get the train dataset</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>bag <span class="ot">&lt;-</span> <span class="fu">get_bags</span>(pheno_mat,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                <span class="at">dist_mat_or_tree =</span> tree, </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                <span class="at">bag_size =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), <span class="co"># number of strains in each class</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>                <span class="at">no_rf =</span> <span class="dv">10</span>, <span class="co"># specify the number of datasets</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                <span class="at">bagging =</span> <span class="st">&quot;phylogenetic_walk&quot;</span> <span class="co"># specify the bagging algorithm</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>                )</span></code></pre></div>
<p>Now that the 10 training datasets were obtained, we can start
building XGBoost models. Once an XGBoost model is built we can pull out
the importances (feature gains in this case) and we can also use the
model to predict classification probabilities of the original dataset.
In case of a multiclass problem the feature importances will not make
much sense. Thus, let’s reduce the number of classes to two: rodent and
the rest.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># make a list that will hold all the feature importances</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>importances <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="dv">10</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co"># make a list that will hold all the classification probabilities</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="dv">10</span>)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co"># gene names from panaroo are not valid column names</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>gene_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(bin_mat)[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(bin_mat)]</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>bin_mat_adjust <span class="ot">&lt;-</span> bin_mat</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="fu">colnames</span>(bin_mat_adjust)[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(bin_mat_adjust)] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">&quot;gene&quot;</span>, <span class="fu">ncol</span>(bin_mat_adjust)), <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(bin_mat_adjust)))</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">names</span>(gene_names) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(bin_mat_adjust)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  <span class="co"># Construct new pheno_mat and bin_mat</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  boot_pheno_mat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ids =</span> bag<span class="sc">$</span>bags[[i]],</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>                             <span class="at">pheno =</span> pheno_mat<span class="sc">$</span>pheno[<span class="fu">match</span>(bag<span class="sc">$</span>bags[[i]], pheno_mat<span class="sc">$</span>ids)])</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  boot_pheno_mat<span class="sc">$</span>pheno <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(boot_pheno_mat<span class="sc">$</span>pheno <span class="sc">==</span> <span class="st">&quot;rodent&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="co"># 1 = rodent, 0 = other host</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  boot_bin_mat<span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(bin_mat_adjust[<span class="fu">match</span>(bag<span class="sc">$</span>bags[[i]], <span class="fu">rownames</span>(bin_mat_adjust)), ])</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>  </span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="co"># train XGBoost model</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(boot_bin_mat),</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>                   <span class="at">label =</span> boot_pheno_mat<span class="sc">$</span>pheno,</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>                   <span class="at">nrounds =</span> <span class="dv">10</span>,</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>                   <span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>  importances[[i]] <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">xgb.importance</span>(<span class="at">model =</span> model)[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>  probs[[i]] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, bin_mat_adjust)</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>}</span></code></pre></div>
<p>The last step is to calculate median for all feature importances and
the number of times it was used in the 10 models. Additionally, the
median of the 10 classification probabilities will also be calculated.
This will allow us to identify potentially mislabeled strains.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># analyze the classification probabilities</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">do.call</span>(cbind, probs), <span class="dv">1</span>, median)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>df_probs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ids =</span> <span class="fu">rownames</span>(bin_mat_adjust),</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                       <span class="at">probs_med =</span> medians,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>                       <span class="at">host =</span> pheno_mat<span class="sc">$</span>pheno)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># analyze the feature importances</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>df_importances <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, importances))</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>df_importances<span class="sc">$</span>Feature <span class="ot">&lt;-</span> gene_names[<span class="fu">match</span>(df_importances<span class="sc">$</span>Feature, <span class="fu">names</span>(gene_names))]</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>features <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(df_importances<span class="sc">$</span>Feature))</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>features <span class="ot">&lt;-</span> features[features<span class="sc">$</span>Freq <span class="sc">&gt;</span> <span class="dv">1</span>, ]</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>features<span class="sc">$</span>importance <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(features))</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(features)) {</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  features<span class="sc">$</span>importance[i] <span class="ot">&lt;-</span> <span class="fu">median</span>(<span class="fu">as.numeric</span>(df_importances<span class="sc">$</span>Gain[df_importances<span class="sc">$</span>Feature <span class="sc">==</span> features<span class="sc">$</span>Var1[i]]))</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>}</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>features <span class="ot">&lt;-</span> features[<span class="fu">order</span>(features<span class="sc">$</span>Freq, features<span class="sc">$</span>importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="fu">colnames</span>(features) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Gene&quot;</span>, <span class="st">&quot;Frequence&quot;</span>, <span class="st">&quot;Importance&quot;</span>)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co"># print the top 15 features along with their frequences in the 10 models and the median of their importances</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(features[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>,], <span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">table.attr =</span> <span class="st">&quot;class=&#39;table table-striped&#39;&quot;</span>)</span></code></pre></div>
<table class="table table-striped">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Gene
</th>
<th style="text-align:right;">
Frequence
</th>
<th style="text-align:right;">
Importance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
35
</td>
<td style="text-align:left;">
group_2194
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.1991308
</td>
</tr>
<tr>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
group_1477
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0572528
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:left;">
menC~~~menC_1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.2774226
</td>
</tr>
<tr>
<td style="text-align:left;">
65
</td>
<td style="text-align:left;">
group_2969
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.1257621
</td>
</tr>
<tr>
<td style="text-align:left;">
32
</td>
<td style="text-align:left;">
group_2082
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0698542
</td>
</tr>
<tr>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
carA_2~~~carA_1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0580692
</td>
</tr>
<tr>
<td style="text-align:left;">
112
</td>
<td style="text-align:left;">
group_623
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0449499
</td>
</tr>
<tr>
<td style="text-align:left;">
60
</td>
<td style="text-align:left;">
group_2882
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0320840
</td>
</tr>
<tr>
<td style="text-align:left;">
43
</td>
<td style="text-align:left;">
group_2524
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0251857
</td>
</tr>
<tr>
<td style="text-align:left;">
76
</td>
<td style="text-align:left;">
group_3330
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0196577
</td>
</tr>
<tr>
<td style="text-align:left;">
111
</td>
<td style="text-align:left;">
group_5689
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0168678
</td>
</tr>
<tr>
<td style="text-align:left;">
129
</td>
<td style="text-align:left;">
rmlA~<del>rmlA_1</del>~rmlA_2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0130946
</td>
</tr>
<tr>
<td style="text-align:left;">
113
</td>
<td style="text-align:left;">
group_653
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0015605
</td>
</tr>
<tr>
<td style="text-align:left;">
121
</td>
<td style="text-align:left;">
larQ
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0431579
</td>
</tr>
<tr>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
group_1839
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0339481
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">head</span>(features, <span class="dv">15</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt;                       Gene Frequence  Importance</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; 35              group_2194         7 0.199130803</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; 20              group_1477         6 0.057252753</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; 123          menC~~~menC_1         5 0.277422628</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; 65              group_2969         4 0.125762060</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; 32              group_2082         4 0.069854183</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; 9          carA_2~~~carA_1         4 0.058069248</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; 112              group_623         4 0.044949936</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; 60              group_2882         4 0.032084000</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; 43              group_2524         4 0.025185663</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; 76              group_3330         4 0.019657743</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; 111             group_5689         4 0.016867830</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; 129 rmlA~~~rmlA_1~~~rmlA_2         4 0.013094628</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; 113              group_653         4 0.001560522</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; 121                   larQ         3 0.043157862</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; 25              group_1839         3 0.033948084</span></span></code></pre></div>
<p>These results contain some of the experimentally confirmed rodent
colonization factors and we can thus conclude that the models (at least
partially) were able to identify causal features. In the next cell, we
will plot the classification probabilities. This will allow us to
identify strains that might be mislabeled.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>df_probs <span class="ot">&lt;-</span> df_probs[<span class="fu">order</span>(df_probs<span class="sc">$</span>probs_med, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">ggplot</span>(df_probs, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_probs), <span class="at">y =</span> probs_med, <span class="at">color =</span> host)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;XGBoost results&quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;analysed strains&quot;</span>,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Classification probability&quot;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Host&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Assuming that the model does not overfit or underfit we would
conclude that the majority of <em>L. reuteri</em> rodent strains are
autochthonous in the host while a few strains appear to be mislabeled.
For more thorough discussion on <em>L. reuteri</em> adaptation
mechanisms see the main <em>aurora</em> manuscript.</p>
</div>
<div id="example-3" class="section level1">
<h1>Example 3:</h1>
<p>In this last example we will compare two plots. One plot will show a
the original <em>L. reuteri</em> dataset, the other will show the
boostrapped <em>L. reuteri</em> dataset. Using <code>get_bags()</code>
should result in mitigating the bias that originates from population
structure and sampling bias.</p>
<p><img src="data:image/png;base64,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" width="50%" /><img src="data:image/png;base64,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" width="50%" /></p>
<p>The unadjusted plot is not as well separated as the adjusted plot.
Specifically, the porcine strains are intermixed with poultry strains in
the unadjusted plot. As we show in the main <em>aurora</em> paper,
isolates from these two hosts are actually very distinct from each other
but the unadjusted analysis does not communicate this well.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
